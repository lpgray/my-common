/*! gtis-common 2013-07-25 */
function beforeRemove(){$(".j_btn_del,.j_ask").click(function(){var e=$(this).attr("data-ask")||"确定执行删除操作吗？";return window.confirm(e)})}var Utils={};Utils.hasFeature=function(e){return document.getElementsByTagName("html")[0].className.indexOf(e)>-1},Utils.filterFileName=function(e){if(e){var t=e.indexOf("\\")>=0?e.lastIndexOf("\\"):e.lastIndexOf("/"),i=e.substring(t);return(0===i.indexOf("\\")||0===i.indexOf("/"))&&(i=i.substring(1)),i}},Utils.isMobile=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)},Utils.encodeXML=function(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")},Utils.multipleToSingle=function(e,t){var n,a={};t?t+=".":t="";for(i in e)"[object Object]"!==Object.prototype.toString.apply(e[i])?a[t+i]=e[i]:(n=multipleToSingle(e[i],i),$.extend(!0,a,n));return a},Utils.getUrlParam=function(e){if(paramValue="",isFound=!1,0==this.location.search.indexOf("?")&&this.location.search.indexOf("=")>1)for(arrSource=unescape(this.location.search).substring(1,this.location.search.length).split("&"),i=0;arrSource.length>i&&!isFound;)arrSource[i].indexOf("=")>0&&arrSource[i].split("=")[0].toLowerCase()==e.toLowerCase()&&(paramValue=arrSource[i].split("=")[1],isFound=!0),i++;return paramValue},document.getElementsByClassName||(document.getElementsByClassName=function(e,t,i){t=t||document,i=i||"*";var n=[],a="*"===i&&t.all?t.all:t.getElementsByTagName(i),r=a.length;e=e.replace(/\-/g,"\\-");for(var s=RegExp("(^|\\s)"+e+"(\\s|$)");--r>=0;)s.test(a[r].className)&&n.push(a[r]);return n}),$(document).on("click",'[href="#"],.disabled',function(e){e.preventDefault()}),function(){for(var e,t=function(){},i=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],n=i.length,a=window.console=window.console||{};n--;)e=i[n],a[e]||(a[e]=t)}(),function(e){var t=function(){return this};t.prototype={tmpl:"<div id='_loadingWrap' class='._loading_wrap'><div class='_inner'><div class='_main'></div><div class='_cover'></div></div></div>",show:function(t,i){e("._loading_wrap").remove();var n,a=i||"body",r=t||"正在努力加载",s=e(this.tmpl);this.elem=s,n=this.elem.find("._main"),n.html(r),e(a).css("position","relative").append(this.elem),this.elem.css("display","block"),n.css("margin-left","-"+n.outerWidth()/2+"px")},hide:function(){this.elem.fadeOut("fast",function(){e("._loading_wrap").remove()})}},window.loading=new t}(jQuery),function(e){"use strict";var t={fetchCallback:null,hideCallback:function(){},openCallback:function(){}},i=function(t,i){this.options=t,this.elem=e(i),this.init()};i.prototype={init:function(){var t=this;e(t.elem).children("tr,li").each(function(){t.renderItem(this)}),e(t.elem).delegate("._treetoggle","click",function(){t.move(e(this).parents("li,tr")[0])})},renderItem:function(t){if(!e(t).find("._treetoggle").length){var i=this.parentNumber(t),n=this.childrenStatus(t);return this.addPrefix(i,n,t),t}},parentNumber:function(t){var i=e(t).attr("data-parent"),n=0;return i&&(n+=1,n+=this.parentNumber("#"+i)),n},childrenStatus:function(t){var i=e('[data-parent="'+e(t).attr("id")+'"]').length?1:0;return i||"true"!==e(t).attr("data-has-child")||(i=2),i},move:function(t){var i=e(t).attr("id"),n=e(t).find("._treetoggle"),a=this.childrenStatus(t);n.hasClass("_open")?this.hideChildren(i):n.hasClass("_close")&&1===a?(this.elem.find("[data-parent="+i+"]").removeClass("hide"),e(t).find("._close").removeClass("_close").addClass("_open"),this.options.openCallback(e(t))):this.fetch(t)},hideChildren:function(t){var i=this;this.elem.find("[data-parent="+t+"]").each(function(){e(this).addClass("hide"),i.hideChildren(e(this).attr("id"))}),e("#"+t).find("._open").removeClass("_open").addClass("_close"),i.options.hideCallback(e("#"+t))},addPrefix:function(t,i,n){var a,r="<i class='ico ico-blank'></i>",s="<i class='_treetoggle ico _open'></i>",l="<i class='_treetoggle ico _close'></i>",o="<i class='ico _root'></i>";switch(a=e(n).children("td:first-child").length?e(n).children("td:first-child"):e(n).children("a"),a.html("<span>"+a.html()+"</span>"),i){case 1:a.prepend(s);break;case 0:a.prepend(o);break;case 2:a.prepend(l)}for(var c=0;t>c;c++)a.prepend(r)},fetch:function(t){var i=this,n=e(t).attr("data-url");return n?(n&&e.ajax({url:n,dataType:"html",success:function(n){var a=e("<div />");a.html(n),e(t).after(a.html()).find("._treetoggle").removeClass("_close").addClass("_open"),e(e(t).parents("ul,table")[0]).children("tr,li").each(function(){i.renderItem(this)})}}),void 0):(alert("没有设置标签属性data-url"),void 0)}},e.fn.listtree=function(n){return this.each(function(){e(this).addClass("_listtree");var a=e.extend({},t,n),r=e(this).data("tree");r||e(this).data("tree",r=new i(a,this))})},e.fn.gridtree=function(n){return this.each(function(){var a=e.extend({},t,n);e(this).addClass("_gridtree");var r=e(this).data("tree");r||e(this).data("tree",r=new i(a,this))})}}(jQuery),function(e){e.fn.serializeObject=function(){var t,n=function(e){return e=e.replace(/"/g,'\\"').replace(/'/g,'\\"').replace(/‘/g,'\\"').replace(/’/g,'\\"').replace(/“/g,'\\"').replace(/”/g,'\\"')},a={},r=this.serializeArray(),s={};return e.each(r,function(){if(this.value=n(this.value),this.name.indexOf(".")>-1){var r=this.name.split(".");for(i=0;r.length>i;i++)0==i?(s[r[i]]=s[r[i]]?e.extend({},s[r[i]]):{},t=s[r[i]]):i==r.length-1?t[r[i]]=this.value||"":(t[r[i]]=t[r[i]]?e.extend({},t[r[i]]):{},t=t[r[i]]);return a[r[0]]=a[r[0]]?e.extend({},a[r[0]],s[r[0]]):s[r[0]],void 0}void 0!==a[this.name]?(a[this.name].push||(a[this.name]=[a[this.name]]),a[this.name].push(this.value||"")):a[this.name]=this.value||""}),a}}(jQuery),function(e){var t=function(t,i){var t=e(t),n=t.css("background-color");t.css("background-color",i.color),t.animate({"background-color":n},1e3)};e.fn.focusresult=function(i){var n=e.extend({},i,e.fn.focusresult.defaults);return t(this,n),this},e.fn.focusresult.defaults={color:"red",duration:1e3}}(jQuery),function(e){var t=function(t){this.elem=e(t)},i={tpl:'<div class="final-panel j_final_panel hide"><a href="#" class="btn btn-mini j_reset"><i class="icon-remove-circle"></i> 撤销更改</a> <a href="#" class="btn btn-primary btn-mini j_confirm"><i class="icon-ok-sign icon-white"></i> 保存更改</a></div>',reset:function(){alert("点击撤销")},confirm:function(){alert("点击保存")}};t.prototype={show:function(){var e=this.elem;e.hasClass("fix-top")||e.fadeIn(500,function(){e.addClass("fix-top")})},hide:function(){var e=this.elem;e.hasClass("fix-top")&&e.fadeOut(500,function(){e.removeClass("fix-top")})}},e.fn.confirms=function(n){var a,r,s=this.children(".j_final_panel");return s.length||(a=e.extend({},i,n),this.css("position","relative"),this.append(a.tpl),s=this.children(".j_final_panel"),this.children(".j_final_panel").children(".j_reset").click(function(){a.reset(),r.hide()}),this.children(".j_final_panel").children(".j_confirm").click(function(){a.confirm(),r.hide()})),this.data("confirmpanel")?r=this.data("confirmpanel"):this.data("confirmpanel",r=new t(s)),r.show(),this}}(window.jQuery),function(e){var t=function(e){this.opts=e},i={tpl:"<a href='#' class='_linkremove j_btn_del remove hide' style='position:absolute;top:0;right:0;-webkit-transition: display .5s ease .5s;text-decoration: none;' onclick='$(this).parent().slideUp()'>×</a>",style:{color:"white","background-color":"#CE3939",padding:"5px 15px",font:"normal bold 30px arial","border-radius":"0 5px 0 0"}};t.prototype={render:function(t){var i=e(this.opts.tpl);return t&&i.attr("href",t),i.css(this.opts.style),i}},e.fn.closeremove=function(n){return this.each(function(){var a=e(this),r=e.extend(!0,{},i,n);a.css("position","relative"),$link=new t(r).render(a.attr("data-url")),a.append($link),a.hover(function(){e(this).children("._linkremove").css("display","block")},function(){e(this).children("._linkremove").css("display","none")})})}}(jQuery),function(e){e.fn.ajaxSubmit=function(t){this.validationEngine();var i=this;if(!i.attr("action"))return alert(i.attr("id")+"的action没有设定"),void 0;if(i.validationEngine("validate"))return t.loading&&loading.show(t.loading),e.ajax({url:i.attr("action"),type:i.attr("method")||"get",data:i.serialize(),dataType:"html",success:function(e){t.callback&&t.callback(e),loading.hide()}}),this}}(jQuery),Utils.pagin=function(e,t,n,a,r,s){function l(){var e,t=o.children("span").children("a"),i=o.children("span").children(".active"),n=[];if(t.length>r){e=i.index()+1,t.each(function(i){return n.length>=r?!1:(i+=1,i===e||i===e-1||i===e+1||1===i||2===i||i===t.length-1||i===t.length?(n.push(i),void 0):void 0)});for(var a=e-2;a>2&&!(n.length>=r);a--)n.contains(a)||n.push(a);for(var a=e+2;t.length-1>a&&!(n.length>=r);a++)n.contains(a)||n.push(a);n.sort(function(e,t){return e>t}),t.each(function(e){e+=1,n.contains(e)||$(this).remove()}),t=o.children("span").children("a");for(var a=1;n.length>a;a++)n[a]-n[a-1]>1&&$(t[a-1]).after("<strong> ... </strong>")}}Array.prototype.contains=function(e){for(i in this)if(this[i]==e)return!0;return!1};var o=$(e),c="page.page",d="page.size",h=o.children(".prev"),u=o.children(".next"),f=location.href,p="?";p=s?s:f.indexOf("?")>-1&&-1==f.indexOf(c)?f+"&":f.indexOf(c)>-1?f.substring(0,f.indexOf(c)):"?";var m=Math.ceil(a/n);for(1==t&&h.addClass("disabled"),t==m&&u.addClass("disabled"),o.children("span").children().remove(),i=1;m>=i;i++){var g=$("<a />").attr({href:p+c+"="+i+"&"+d+"="+n}).html(i);o.children("span").append(g),i==t&&(g.addClass("active"),g.attr("href","#"))}h.attr({href:p+c+"="+(t-1)+"&"+d+"="+n}),u.attr({href:p+c+"="+(t+1)+"&"+d+"="+n}),l(t),o.find("a").addClass("j_pagin_link")},Utils.ajax4data=function(){$(document).delegate(".a4d","click",function(){var e,t,i=$(this).attr("data-url")||$(this).attr("href"),n=$(this).attr("data-result-ctn"),a="";return n?(-1!==n.search(/\(/)?(e=n.substring(n.indexOf("(")+1,n.indexOf(")")),n=n.substring(0,n.indexOf("("))):e="html",t=$(n),loading.show("正在请求数据"),i&&(a=i.indexOf("?")>-1?"&d=":"?d=",i&&$.ajax({url:i+a+(new Date).getMilliseconds(),dataType:"html",success:function(i){t[e](i),t.find("form").validationEngine(),loading.hide()}})),!1):(alert("没有设定存放结果的容器选择符"),!1)})},Utils.ajax4data();